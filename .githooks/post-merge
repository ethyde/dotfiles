#!/bin/bash
#==============================================================================
# Hook Git post-merge
# Corrige automatiquement les permissions des scripts apr√®s un git pull/merge
#==============================================================================

# Se positionner √† la racine du projet pour assurer la coh√©rence des chemins
REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT" || exit 1

FIX_SCRIPT="./bin/fix-permissions.sh"

# V√©rifier si le script de correction existe et est ex√©cutable
if [ -f "$FIX_SCRIPT" ]; then
    if [ ! -x "$FIX_SCRIPT" ]; then
        echo "üîß Le script de correction existe mais n'est pas ex√©cutable. Tentative de correction..."
        chmod +x "$FIX_SCRIPT"
    fi

    echo "üîß Lancement de la correction des permissions..."
    # Ex√©cute le script en s'assurant que le shell ne garde pas un ancien hash du chemin
    hash -r
    
    # Redirection de la sortie pour ne voir que le r√©sultat final
    if "$FIX_SCRIPT" --fix > /dev/null 2>&1; then
        echo "‚úÖ Permissions corrig√©es avec succ√®s."
    else
        echo "‚ö†Ô∏è  Erreur lors de l'ex√©cution de fix-permissions.sh."
    fi
else
    echo "‚ö†Ô∏è  Script de correction '$FIX_SCRIPT' non trouv√©. Permissions non v√©rifi√©es."
    echo "üí° Assurez-vous qu'il se trouve bien √† la racine dans le dossier 'bin/'."
fi