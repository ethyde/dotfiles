# ~/.shell_interactive_setup
# ==============================================================================
#      SCRIPTS POUR LES SESSIONS INTERACTIVES (Bash, Zsh, etc.)
#
#    Ce fichier est sourcé par .bashrc et .zshrc pour assurer un
#    comportement identique au démarrage des sessions interactives.
# ==============================================================================


# ==============================================================================
#                      AUTO-CHARGEMENT DE L'AGENT SSH
#
#    Vérifie l'état de l'agent SSH et charge les clés si nécessaire.
#    Affiche des messages pour informer l'utilisateur.
# ==============================================================================
agent_load_env
if ! agent_is_running; then
    echo "Agent SSH non trouvé, démarrage..."
    agent_start
    echo "Agent démarré. Tentative de chargement des clés..."
    add_all_keys
elif ! agent_has_keys; then
    echo "Agent SSH trouvé, mais aucune clé chargée. Tentative..."
    add_all_keys
else
    echo "Agent SSH prêt et clés déjà chargées."
fi

# ==============================================================================
#                      VÉRIFICATION INITIALE DE LA VERSION NODE.JS
#
#    Vérifie s'il y a un .nvmrc dans le répertoire courant au démarrage
#    et ajuste la version de Node.js en conséquence.
# ==============================================================================
if command -v nvm &> /dev/null; then
    local nvmrc_path
    nvmrc_path=$(nvm_find_up .nvmrc)
    
    if [[ -n "$nvmrc_path" ]]; then
        local nvmrc_version
        nvmrc_version=$(<"$nvmrc_path/.nvmrc")
        echo "Fichier .nvmrc détecté avec la version: $nvmrc_version"
        
        if ! nvm use 2>/dev/null; then
            echo "Version Node.js '$nvmrc_version' non installée, installation..."
            nvm install
        else
            echo "Version Node.js activée: $(nvm current)"
        fi
    fi
fi 