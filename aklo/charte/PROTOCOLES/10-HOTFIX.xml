# PROTOCOLE SP√âCIFIQUE : GESTION DE HOTFIX (CORRECTION D'URGENCE)

Ce protocole s'active **uniquement** pour corriger un bug critique en production qui bloque les utilisateurs ou cause une perte de revenus imm√©diate. Il court-circuite le flux de travail standard pour une rapidit√© maximale.

## SECTION 1 : MISSION ET LIVRABLES

### 1.1. Mission

Restaurer le service en production le plus rapidement possible en appliquant un correctif minimaliste et cibl√©, tout en documentant la proc√©dure pour assurer la tra√ßabilit√©.

### 1.2. Livrables Attendus

1.  **Rapport de Hotfix :** Un fichier `HOTFIX-[ID].xml` cr√©√© dans `/docs/backlog/08-hotfixes/`, documentant le probl√®me et la solution.
2.  **Commit de Hotfix :** Un `commit` contenant **uniquement** la correction minimale.
3.  **Tag Git de Patch :** Un nouveau tag de version de patch (ex: `v1.2.1`).

## SECTION 2 : ARTEFACT HOTFIX - GESTION ET STRUCTURE

### 2.1. Nommage

-   `HOTFIX-[ID].xml`
    -   `[ID]` : Un identifiant unique pour le hotfix (ex: `bug-login-prod-20250628`).

### 2.2. Statuts

-   `INVESTIGATING` : L'analyse de la cause racine est en cours.
-   `AWAITING_FIX` : Le diagnostic est pos√© et un plan de correction attend la validation du `Human_Developer`.
-   `DEPLOYING` : Le correctif a √©t√© valid√©, build√©, et est en cours de d√©ploiement.
-   `RESOLVED` : Le hotfix est en production, et les actions de suivi (post-mortem) sont planifi√©es.

### 2.3. Structure Obligatoire du Fichier Hotfix

```markdown
# RAPPORT DE HOTFIX : [ID]

---
**Responsable:** [Nom du Human_Developer]
**Statut:** [INVESTIGATING | AWAITING_FIX | DEPLOYING | RESOLVED]
**Date de D√©tection:** AAAA-MM-JJ HH:MM
**Version Affect√©e:** vX.X.X
**Impact Critique:** [Description concise de l'impact m√©tier. Ex: "Les nouveaux utilisateurs ne peuvent pas s'inscrire", "Le panier d'achat est inaccessible"]
---

## 1. Probl√®me Critique

*Description du bug, son impact sur les utilisateurs/revenus, et la preuve de son existence en production.*

## 2. Analyse de Cause Racine (Rapide)

*Diagnostic rapide pour identifier la source imm√©diate du probl√®me.*

## 3. Solution de Contournement Minimale Appliqu√©e

*Description du changement de code minimaliste appliqu√©. Il faut ici justifier pourquoi c'est la plus petite modification possible pour r√©soudre le probl√®me.*

## 4. Plan de Post-Mortem

- [ ] Un `PBI` ou une `Task` de `DEBOGAGE` a √©t√© cr√©√© pour analyser la cause racine en profondeur et appliquer une solution d√©finitive.
- [ ] Le correctif du hotfix a √©t√© report√© sur la branche de d√©veloppement principale.
```

## SECTION 3 : PROC√âDURE DE HOTFIX

**üõ´ PLAN DE VOL HOTFIX (Obligatoire avant Phase 1)**

Avant toute proc√©dure de hotfix d'urgence, l'agent **doit** pr√©senter un plan d√©taill√© :

**[PLAN_DE_VOL_HOTFIX]**
**Objectif :** Corriger un bug critique en production avec un impact minimal et maximal de rapidit√©
**Actions pr√©vues :**
1. Validation de l'urgence r√©elle avec le Human_Developer
2. Lecture de la configuration `.aklo.conf` pour conventions de hotfix
3. Cr√©ation du rapport `HOTFIX-[ID].xml` dans `/docs/backlog/08-hotfixes/`
4. Identification du tag de production actuellement d√©ploy√©
5. Cr√©ation de branche hotfix depuis le tag de production
6. Diagnostic rapide de la cause racine du bug critique
7. Impl√©mentation de la correction minimale via protocole DEVELOPPEMENT
8. Build, test et d√©ploiement d'urgence avec nouveau tag de patch
9. Planification du post-mortem et synchronisation des branches

**Fichiers affect√©s :**
- `/docs/backlog/08-hotfixes/HOTFIX-[ID].xml` : cr√©ation et suivi
- Fichiers de code source pour correction minimale
- Possibles nouveaux fichiers de tests de non-r√©gression
- Nouveaux PBI/TASK pour correction d√©finitive (post-mortem)
- Tag Git de patch pour nouvelle version

**Commandes syst√®me :**
- `aklo hotfix "<description>"` : automatisation hotfix (optionnel)
- `git checkout [tag-production]` : retour au tag de production
- `git checkout -b hotfix/[description]` : cr√©ation branche hotfix
- Tests d'urgence pour validation de la correction
- Build et d√©ploiement d'urgence
- `aklo hotfix publish` : automatisation publication (optionnel)

**Outils MCP utilis√©s :**
- `mcp_desktop-commander_read_file` : lire configuration .aklo.conf
- `mcp_desktop-commander_write_file` : cr√©er rapport hotfix
- `mcp_desktop-commander_edit_block` : correction minimale du code
- `mcp_desktop-commander_execute_command` : git, tests, build, d√©ploiement
- `mcp_aklo-terminal_aklo_execute` : commandes aklo (si utilis√©es)

**Validation requise :** ‚úÖ OUI - Attente approbation explicite avant hotfix d'urgence

1.  **[ANALYSE] Phase 1 : Lecture de la Configuration et Validation de l'Urgence**
      - Lire et charger les conventions depuis `.aklo.conf`.
      - **[ATTENTE\_VALIDATION]** Confirmer avec le `Human_Developer` que la situation justifie bien un `HOTFIX` et non un cycle de [DEBOGAGE] normal.

2.  **[PROCEDURE] Phase 2 : Cr√©ation de la Branche d'Urgence**
      - **Action Requise :** 
            - Cr√©er un fichier `HOTFIX-[ID].xml`.
            - Identifier le tag de la version actuellement en production.
            - Cr√©er une branche de hotfix (ex: `hotfix/fix-login-bug`) directement depuis ce **tag de production**.
      - **‚ö° Automatisation `aklo` :** `aklo hotfix "<description du bug>"`

3.  **[PROCEDURE] Phase 3 : Correction Minimale**
      - **Activer le protocole [DEVELOPPEMENT]** avec une contrainte stricte : le changement de code doit √™tre le plus petit et le plus cibl√© possible. **Aucun refactoring ou am√©lioration n'est autoris√©.**
      - L'objectif est de faire passer les tests les plus critiques et de valider manuellement que le bug a disparu.

4.  **[ATTENTE\_VALIDATION] Phase 4 : Validation du Correctif**
      - Soumettre le `diff` minimaliste pour approbation au `Human_Developer`. C'est une validation critique.

5.  **[PROCEDURE] Phase 5 : D√©ploiement d'Urgence et Planification du Suivi**
      - **Action Requise :** 
            -   Une fois le correctif valid√©, fusionner la branche de hotfix directement dans la **Branche de production**.
            -   Cr√©er un nouveau **tag de patch** sur cette branche.
            -   Lancer le build et d√©ployer cette nouvelle version patch√©e imm√©diatement.
            -   **Imm√©diatement apr√®s la confirmation du d√©ploiement r√©ussi**, remplir la section "Plan de Post-Mortem" dans le rapport `HOTFIX-[ID].xml`. Cela implique de cr√©er une nouvelle `Task` ou un nouveau `PBI` pour la correction d√©finitive via le protocole [DEBOGAGE].
      - **‚ö° Automatisation `aklo` :** `aklo hotfix publish`

6.  **[CONCLUSION] Phase 6 : Synchronisation et Cl√¥ture**
    -   Apr√®s le d√©ploiement et la planification du suivi, fusionner la **Branche de production** dans la **Branche de d√©veloppement principale** pour s'assurer que le correctif est bien pr√©sent pour les futurs d√©veloppements.
    -   Informer le `Human_Developer` que :
        1. La production est stabilis√©e.
        2. La proc√©dure de suivi (post-mortem) a √©t√© cr√©√©e et est tra√ßable via le rapport de hotfix.
